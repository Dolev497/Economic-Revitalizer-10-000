<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GPT Response with TTS</title>
</head>
<body>
<h1>GPT Response + Text-to-Speech Demo</h1>
<button id="runButton">Generate & Speak</button>

<script>
const OPENAI_API_KEY = ""
async function generateAndSpeak() {
  try {
    // 1️⃣ Call GPT Responses API
    const response = await fetch("https://api.openai.com/v1/responses", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${OPENAI_API_KEY}`,
      },
      body: JSON.stringify({
        prompt: {
          id: "pmpt_690794c4f9ec81908f0d190cd0b1560408819a17f7bb15bf",
          version: "2"
        },
        input: [
          {
            role: "user",
            content: [
              { type: "input_text", text: "generate" }
            ]
          }
        ],
        max_output_tokens: 2048,
        store: true,
        include: ["web_search_call.action.sources"]
      })
    });

    const data = await response.json();
    console.log("Raw GPT Response:", data);

    // 2️⃣ Extract all output_text blocks
    const texts = [];
    if (data.output && Array.isArray(data.output)) {
      data.output.forEach(item => {
        if (item.content) {
          item.content.forEach(block => {
            if (block.type === "output_text") {
              texts.push(block.text);
            }
          });
        }
      });
    }

    // 3️⃣ Speak each text using TTS
    for (const text of texts) {
      console.log("Speaking:", text);
      const utterance = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(utterance);

      // Wait until the current speech finishes before continuing
      await new Promise(resolve => {
        utterance.onend = resolve;
      });
    }

  } catch (error) {
    console.error("Error:", error);
  }
}

// Optional: button to trigger
document.getElementById("runButton").addEventListener("click", generateAndSpeak);
</script>
</body>
</html>


